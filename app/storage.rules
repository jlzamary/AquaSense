rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Uploads directory - organized by userId
    match /uploads/{userId}/{fileName} {
      // Users can always read their own files
      allow read: if request.auth != null && userId == request.auth.uid;
      
      // Users can read files if they belong to a shared project
      // Note: This is a simplified rule - in production you'd want to check project membership via Firestore
      // For now, allow all authenticated users to read (since Firestore controls which analyses they can see)
      allow read: if request.auth != null;
      
      // Users can only write to their own directory
      allow write: if request.auth != null && userId == request.auth.uid;
    }
  }
}

